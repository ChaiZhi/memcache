package com.twofish.core.cache;

import org.apache.commons.lang.StringUtils;
import org.apache.log4j.Logger;

import com.happyelements.config.ApplicationProperties;
import com.happyelements.config.metaxml.MemCacheConfXml;
import com.happyelements.platform.PlatformEnum;

public enum MemCacheFactory {
	INSTANCE;
	
	private IMemCacheManager client;
	
	private static final Logger logger=Logger.getLogger(MemCacheFactory.class);
	
	private MemCacheFactory(){
	}
	
	public static MemCacheFactory getInstance() {
		return INSTANCE;
	}

	public IMemCacheManager getMemCacheManager() {
		if(client==null){
			synchronized (MemCacheFactory.class) {
				if (client==null){
					client = createClient(MemCacheConfXml.getInstance().getServers());
				}
			}
		}
		return client;
	}
	
	public void reset(String serveraddrs){
		if (client != null){
			client.reset(serveraddrs);
		}
	}
	
	protected IMemCacheManager createClient(String servers) {
		PlatformEnum platform=ApplicationProperties.getInstance().getPlatformType();
		IMemCacheManager client=null;
		if(StringUtils.isNotEmpty(servers)){
			client = new EasyCacheClient(servers,platform.isUseConsistantHash());
		}else{
			logger.error("server addr is empty!");
		}
		return client;
	}
	
}

